<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Academic Conference Tracker â€” Finance Â· Accounting Â· Economics</title>
  <meta name="description" content="Track 340+ academic conferences in Finance, Accounting, and Economics. Deadlines, tiers, and dates from SSRN FEN/ARN/ERN networks." />
  
  <!-- Vercel Web Analytics -->
  <script>
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Newsreader:opsz,wght@6..72,400;6..72,500;6..72,600;6..72,700&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { background: #0a0e17; color: #e2e8f0; font-family: 'Newsreader', Georgia, serif; }
    html.light { background: #f8fafc; color: #1e293b; }
    body { min-height: 100vh; }
    #root { min-height: 100vh; }
    ::selection { background: rgba(129,140,248,0.3); }
    input, textarea, button { font-family: inherit; }
    a { color: inherit; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }
    html.light ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); }

    /* Tooltip styles */
    .tooltip-container {
      position: relative;
      display: inline-flex;
      align-items: center;
      margin-left: 6px;
      cursor: help;
    }
    .tooltip-icon {
      width: 13px;
      height: 13px;
      border-radius: 50%;
      background-color: rgba(148, 163, 184, 0.3);
      color: #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      font-family: 'Georgia', serif;
      font-style: italic;
      font-weight: bold;
      user-select: none;
    }
    html.light .tooltip-icon {
      background-color: rgba(100, 116, 139, 0.2);
      color: #334155;
    }
    .tooltip {
      visibility: hidden;
      width: 260px;
      background-color: #1e293b;
      color: #e2e8f0;
      text-align: left;
      border-radius: 6px;
      padding: 8px 10px;
      position: absolute;
      z-index: 1;
      bottom: 150%;
      left: 50%;
      margin-left: -130px; /* half of width */
      opacity: 0;
      transition: opacity 0.2s;
      font-size: 11px;
      font-family: 'Newsreader', serif;
      font-weight: 400;
      line-height: 1.5;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    html.light .tooltip {
      background-color: #ffffff;
      color: #1e293b;
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .tooltip-container:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }

    /* Banner styles */
    .update-banner {
      padding: 10px 16px;
      border-radius: 8px;
      margin: 0 0 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      font-size: 13px;
      line-height: 1.5;
    }
    .update-banner strong {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      letter-spacing: -0.01em;
    }
    .update-banner-dismiss {
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 20px;
      line-height: 1;
      padding: 2px 4px;
    }
    /* Dark theme banner */
    .update-banner.dark {
      background: rgba(99, 102, 241, 0.08);
      border: 1px solid rgba(99, 102, 241, 0.2);
      color: #c7d2fe;
    }
    .update-banner.dark strong {
      color: #e0e7ff;
    }
    .update-banner-dismiss.dark {
      color: #a5b4fc;
    }
    .update-banner-dismiss.dark:hover {
      color: #e0e7ff;
    }
    /* Light theme banner */
    .update-banner.light {
      background: rgba(99, 102, 241, 0.06);
      border: 1px solid rgba(99, 102, 241, 0.25);
      color: #4338ca;
    }
    .update-banner.light strong {
      color: #3730a3;
    }
    .update-banner-dismiss.light {
      color: #6366f1;
    }
    .update-banner-dismiss.light:hover {
      color: #3730a3;
    }
  </style>
</head>
<body>
  <div id="root">
    <div style="min-height:100vh;display:flex;align-items:center;justify-content:center;background:#0a0e17">
      <div style="text-align:center">
        <div style="color:#818cf8;font-size:14px;font-family:'JetBrains Mono',monospace;margin-bottom:8px">Loading conferences...</div>
        <div style="color:#4b5563;font-size:11px;font-family:'JetBrains Mono',monospace">Fetching data from conferences.json</div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.26.4/babel.min.js"></script>

  <script type="text/babel" data-type="module">
    const { useState, useMemo, useEffect, useCallback } = React;

    /* â”€â”€ Theme system â”€â”€ */
    const THEME_KEY = "conftracker-theme";
    const THEMES = {
      dark: {
        bg: "#0a0e17",
        text: "#e2e8f0",
        textBright: "#f1f5f9",
        textHeading: "#f8fafc",
        textMuted: "#94a3b8",
        textDim: "#4b5563",
        textDimmer: "#374151",
        cardBg: "rgba(255,255,255,0.025)",
        cardHover: "rgba(255,255,255,0.055)",
        cardBorder: "rgba(255,255,255,0.06)",
        cardBorderHover: "rgba(255,255,255,0.12)",
        inputBg: "rgba(255,255,255,0.025)",
        inputBorder: "rgba(255,255,255,0.07)",
        codeBg: "rgba(0,0,0,0.2)",
        headerGrad: "linear-gradient(180deg, rgba(99,102,241,0.06) 0%, transparent 100%)",
        headerBorder: "rgba(255,255,255,0.04)",
        divider: "rgba(255,255,255,0.04)",
        dividerLight: "rgba(255,255,255,0.03)",
        dividerSubtle: "rgba(255,255,255,0.05)",
        footerBg: "rgba(255,255,255,0.015)",
        footerBorder: "rgba(255,255,255,0.035)",
        adminBg: "rgba(16,185,129,0.03)",
        adminBorder: "rgba(16,185,129,0.15)",
        pastBorder: "rgba(107,114,128,0.2)",
        pastBg: "rgba(107,114,128,0.04)",
        archiveBg: "rgba(107,114,128,0.05)",
        archiveBorder: "rgba(107,114,128,0.1)",
        btnBg: "transparent",
        btnActiveBg: "rgba(129,140,248,0.12)",
        btnBorder: "rgba(255,255,255,0.07)",
        btnActiveBorder: "rgba(129,140,248,0.4)",
        btnColor: "#94a3b8",
        btnActiveColor: "#a5b4fc",
        toggleBg: "rgba(255,255,255,0.06)",
        toggleHover: "rgba(255,255,255,0.1)",
        switchBg: "rgba(255,255,255,0.025)",
        viewBtnBg: "rgba(99,102,241,0.2)",
        viewBtnOffBg: "transparent",
        viewBtnColor: "#a5b4fc",
        viewBtnOffColor: "#64748b",
      },
      light: {
        bg: "#f8fafc",
        text: "#334155",
        textBright: "#0f172a",
        textHeading: "#0f172a",
        textMuted: "#64748b",
        textDim: "#94a3b8",
        textDimmer: "#cbd5e1",
        cardBg: "#ffffff",
        cardHover: "#f1f5f9",
        cardBorder: "rgba(0,0,0,0.08)",
        cardBorderHover: "rgba(0,0,0,0.15)",
        inputBg: "#ffffff",
        inputBorder: "rgba(0,0,0,0.12)",
        codeBg: "rgba(0,0,0,0.04)",
        headerGrad: "linear-gradient(180deg, rgba(99,102,241,0.04) 0%, transparent 100%)",
        headerBorder: "rgba(0,0,0,0.06)",
        divider: "rgba(0,0,0,0.06)",
        dividerLight: "rgba(0,0,0,0.04)",
        dividerSubtle: "rgba(0,0,0,0.06)",
        footerBg: "rgba(0,0,0,0.02)",
        footerBorder: "rgba(0,0,0,0.06)",
        adminBg: "rgba(16,185,129,0.04)",
        adminBorder: "rgba(16,185,129,0.2)",
        pastBorder: "rgba(107,114,128,0.25)",
        pastBg: "rgba(107,114,128,0.06)",
        archiveBg: "rgba(107,114,128,0.06)",
        archiveBorder: "rgba(107,114,128,0.15)",
        btnBg: "transparent",
        btnActiveBg: "rgba(99,102,241,0.1)",
        btnBorder: "rgba(0,0,0,0.1)",
        btnActiveBorder: "rgba(99,102,241,0.4)",
        btnColor: "#64748b",
        btnActiveColor: "#6366f1",
        toggleBg: "rgba(0,0,0,0.06)",
        toggleHover: "rgba(0,0,0,0.1)",
        switchBg: "rgba(0,0,0,0.04)",
        viewBtnBg: "rgba(99,102,241,0.12)",
        viewBtnOffBg: "transparent",
        viewBtnColor: "#6366f1",
        viewBtnOffColor: "#94a3b8",
      }
    };

    function getInitialTheme() {
      try { return localStorage.getItem(THEME_KEY) || "dark"; } catch { return "dark"; }
    }

    /* â”€â”€ Data loading â”€â”€ */
    const JSON_URL = "./conferences.json";
    const TRAVEL_JSON_URL = "./travel-data.json";
    const TODAY = new Date();
    const TODAY_STR = TODAY.toISOString().split("T")[0];

    function expandRaw(r) {
      return {
        id: r.id, name: r.name || r.n, dates: r.dates || r.d,
        startDate: r.startDate || r.s, location: r.location || r.l,
        country: r.country || r.c, disc: r.disc || r.x,
        sid: r.sid || r.si, ssrnLink: r.ssrnLink || r.sl,
        deadline: r.deadline || "TBD", url: r.url || "", tier: r.tier || "",
      };
    }

    /* â”€â”€ Helpers â”€â”€ */
    function getDaysUntil(ds) { return Math.ceil((new Date(ds+"T23:59:59")-new Date(TODAY_STR+"T00:00:00"))/86400000); }
    function fmtShort(s) { return new Date(s+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}); }
    function fmtDeadline(s) { return new Date(s+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}); }
    function isTBD(dl) { return !dl||dl==="TBD"||dl===""||dl==="tbd"; }

    function getRegion(country) {
      const na=["USA","Canada","Mexico","St. Kitts","Puerto Rico"];
      const eu=["UK","France","Germany","Italy","Spain","Netherlands","Switzerland","Belgium","Denmark","Portugal","Greece","Sweden","Finland","Ireland","Norway","Austria","Czech Republic","Poland","Croatia","Cyprus","Romania","Luxembourg","Iceland","Slovenia","Lithuania","Hungary","Turkey"];
      const ap=["China","Japan","South Korea","Singapore","Hong Kong","Australia","India","Indonesia","Taiwan","Thailand","Vietnam","New Zealand"];
      if(country==="Virtual"||country==="Online")return"Virtual";
      if(na.includes(country))return"N. America";
      if(eu.includes(country))return"Europe";
      if(ap.includes(country))return"Asia-Pacific";
      return"Other";
    }

    function getTimeStatus(sd,isDark){
      const d=getDaysUntil(sd);
      if(d<0)return{label:"PAST",color:"#6b7280",bg:"rgba(107,114,128,0.1)"};
      if(d<=14)return{label:d+"d LEFT",color:"#ef4444",bg:isDark?"rgba(239,68,68,0.15)":"rgba(239,68,68,0.1)"};
      if(d<=60)return{label:d+"d",color:isDark?"#f59e0b":"#d97706",bg:isDark?"rgba(245,158,11,0.12)":"rgba(245,158,11,0.08)"};
      if(d<=180)return{label:d+"d",color:isDark?"#10b981":"#059669",bg:isDark?"rgba(16,185,129,0.1)":"rgba(16,185,129,0.08)"};
      return{label:d+"d",color:"#6366f1",bg:isDark?"rgba(99,102,241,0.1)":"rgba(99,102,241,0.08)"};
    }

    function getDeadlineStatus(dl,isDark){
      if(isTBD(dl))return{label:"TBD",color:"#6b7280",bg:isDark?"rgba(107,114,128,0.12)":"rgba(107,114,128,0.08)",isTBD:true};
      const d=getDaysUntil(dl);
      if(d<0)return{label:"CLOSED",color:"#6b7280",bg:"rgba(107,114,128,0.1)",isTBD:false};
      if(d<=7)return{label:d+"d LEFT",color:"#ef4444",bg:isDark?"rgba(239,68,68,0.18)":"rgba(239,68,68,0.1)",isTBD:false};
      if(d<=30)return{label:d+"d",color:isDark?"#f59e0b":"#d97706",bg:isDark?"rgba(245,158,11,0.14)":"rgba(245,158,11,0.08)",isTBD:false};
      if(d<=90)return{label:d+"d",color:isDark?"#10b981":"#059669",bg:isDark?"rgba(16,185,129,0.1)":"rgba(16,185,129,0.08)",isTBD:false};
      return{label:d+"d",color:"#6366f1",bg:isDark?"rgba(99,102,241,0.1)":"rgba(99,102,241,0.08)",isTBD:false};
    }

    function getDeadlineSortKey(c){return isTBD(c.deadline)?"9999-12-31":c.deadline;}

    function getTravelInfo(conf, data) {
      if (!data || !data.cities) return null;
      // Try exact match
      let info = data.cities[conf.location];
      if (!info) {
        // Try fuzzy match? Or just return null.
        // My generator used exact strings from conferences.json so it should match.
        return null;
      }
      return info;
    }

    /* â”€â”€ ICS Generation â”€â”€ */
    function formatICSDate(dateStr) {
      if(!dateStr) return "";
      return dateStr.replace(/-/g, "");
    }

    function createICSContent(conf) {
      const now = new Date().toISOString().replace(/[-:.]/g, "").slice(0, 15) + "Z";
      const start = formatICSDate(conf.startDate);
      
      // Calculate end date (assume 1 day if not specified, or parse from dates string if possible)
      // For simplicity in this single-file setup, we'll just make it a 1-day all-day event
      // matching the start date. 
      const startDateObj = new Date(conf.startDate);
      const endDateObj = new Date(startDateObj);
      endDateObj.setDate(endDateObj.getDate() + 1);
      const end = endDateObj.toISOString().split("T")[0].replace(/-/g, "");

      const desc = `Conference: ${conf.name}\\nLocation: ${conf.location}, ${conf.country}\\nDates: ${conf.dates}\\n\\nDeadline: ${conf.deadline}\\nSSRN: ${conf.ssrnLink}\\nWebsite: ${conf.url || "N/A"}`;
      
      let ics = [];
      ics.push("BEGIN:VEVENT");
      ics.push(`UID:${conf.id}@faeconf.com`);
      ics.push(`DTSTAMP:${now}`);
      ics.push(`DTSTART;VALUE=DATE:${start}`);
      ics.push(`DTEND;VALUE=DATE:${end}`);
      ics.push(`SUMMARY:${conf.name}`);
      ics.push(`LOCATION:${conf.location}, ${conf.country}`);
      ics.push(`DESCRIPTION:${desc.replace(/\\n/g, "\\n")}`);
      ics.push(`URL:${conf.url || conf.ssrnLink}`);

      // Add reminder for deadline if valid
      if (conf.deadline && !isTBD(conf.deadline)) {
        const dlDate = new Date(conf.deadline);
        // Reminder 7 days before deadline at 9 AM UTC
        const reminderDate = new Date(dlDate);
        reminderDate.setDate(reminderDate.getDate() - 7);
        reminderDate.setUTCHours(14, 0, 0, 0); // 9 AM EST = 14:00 UTC approx
        
        // Only add if reminder is in future (or reasonable past)
        // We use an absolute trigger for the alarm
        const trigger = reminderDate.toISOString().replace(/[-:.]/g, "").slice(0, 15) + "Z";
        
        ics.push("BEGIN:VALARM");
        ics.push("ACTION:DISPLAY");
        ics.push("DESCRIPTION:Conference Deadline Upcoming");
        ics.push(`TRIGGER;VALUE=DATE-TIME:${trigger}`);
        ics.push("END:VALARM");
      }

      ics.push("END:VEVENT");
      return ics.join("\r\n");
    }

    function downloadICS(filename, content) {
      const blob = new Blob([content], { type: "text/calendar;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function handleExportOne(conf) {
      const header = ["BEGIN:VCALENDAR", "VERSION:2.0", "PRODID:-//FaeConf//Academic Conference Tracker//EN"].join("\r\n");
      const event = createICSContent(conf);
      const footer = "END:VCALENDAR";
      downloadICS(`conference_${conf.sid || conf.id}.ics`, `${header}\r\n${event}\r\n${footer}`);
    }

    function handleExportAll(conferences) {
      if(!conferences.length) return;
      const header = ["BEGIN:VCALENDAR", "VERSION:2.0", "PRODID:-//FaeConf//Academic Conference Tracker//EN"].join("\r\n");
      const events = conferences.map(createICSContent).join("\r\n");
      const footer = "END:VCALENDAR";
      downloadICS("faeconf_export.ics", `${header}\r\n${events}\r\n${footer}`);
    }

    function deduplicateBySid(data){
      const seen=new Map();
      for(const c of data){if(!seen.has(c.sid)){seen.set(c.sid,c);}else{const ex=seen.get(c.sid);for(const d of(c.disc||[]))if(!ex.disc.includes(d))ex.disc.push(d);if(c.deadline&&c.deadline!=="TBD"&&isTBD(ex.deadline))ex.deadline=c.deadline;if(c.url&&!ex.url)ex.url=c.url;if(c.tier&&!ex.tier)ex.tier=c.tier;}}
      return Array.from(seen.values());
    }

    /* Discipline & region colors â€” adjusted per theme for readability */
    const D={acct:{l:"ACCT",c:"#f472b6",b:"rgba(244,114,182,0.12)"},fin:{l:"FIN",c:"#818cf8",b:"rgba(129,140,248,0.12)"},econ:{l:"ECON",c:"#fbbf24",b:"rgba(251,191,36,0.12)"}};
    const D_LIGHT={acct:{l:"ACCT",c:"#db2777",b:"rgba(219,39,119,0.08)"},fin:{l:"FIN",c:"#6366f1",b:"rgba(99,102,241,0.08)"},econ:{l:"ECON",c:"#d97706",b:"rgba(217,119,6,0.08)"}};
    const R={"N. America":{c:"#60a5fa"},"Europe":{c:"#a78bfa"},"Asia-Pacific":{c:"#34d399"},"Virtual":{c:"#94a3b8"},"Other":{c:"#94a3b8"}};
    const R_LIGHT={"N. America":{c:"#2563eb"},"Europe":{c:"#7c3aed"},"Asia-Pacific":{c:"#059669"},"Virtual":{c:"#64748b"},"Other":{c:"#64748b"}};
    const TIER={"1":{l:"T1",c:"#fbbf24",b:"rgba(251,191,36,0.15)",full:"Tier 1"},"2":{l:"T2",c:"#94a3b8",b:"rgba(148,163,184,0.1)",full:"Tier 2"},"3":{l:"T3",c:"#64748b",b:"rgba(100,116,139,0.08)",full:"Tier 3"}};
    const TIER_LIGHT={"1":{l:"T1",c:"#b45309",b:"rgba(180,83,9,0.1)",full:"Tier 1"},"2":{l:"T2",c:"#64748b",b:"rgba(100,116,139,0.08)",full:"Tier 2"},"3":{l:"T3",c:"#94a3b8",b:"rgba(148,163,184,0.06)",full:"Tier 3"}};

    /* â”€â”€ Theme Toggle Button â”€â”€ */
    function ThemeToggle({isDark, onToggle, T}) {
      return (
        <button onClick={onToggle} title={isDark ? "Switch to light mode" : "Switch to dark mode"}
          style={{display:"flex",alignItems:"center",gap:5,padding:"5px 10px",borderRadius:6,border:"1px solid "+T.cardBorder,background:T.toggleBg,color:T.textMuted,fontSize:11,cursor:"pointer",transition:"all 0.15s",fontFamily:"'JetBrains Mono',monospace"}}
          onMouseEnter={e=>{e.currentTarget.style.background=T.toggleHover;}}
          onMouseLeave={e=>{e.currentTarget.style.background=T.toggleBg;}}>
          <span style={{fontSize:14,lineHeight:1}}>{isDark ? "\u2600\ufe0f" : "\u{1F319}"}</span>
          <span style={{fontSize:10,fontWeight:500}}>{isDark ? "Light" : "Dark"}</span>
        </button>
      );
    }

    /* â”€â”€ Comparison Components â”€â”€ */
    function ComparisonFloater({count, onOpen, onClear, T, isDark}){
      if(count<2)return null;
      return(
        <div style={{position:"fixed",bottom:20,left:"50%",transform:"translateX(-50%)",zIndex:100,display:"flex",alignItems:"center",gap:10,padding:"8px 16px",borderRadius:50,background:isDark?"rgba(30,41,59,0.9)":"rgba(255,255,255,0.9)",border:"1px solid "+(isDark?"rgba(148,163,184,0.2)":"rgba(0,0,0,0.1)"),boxShadow:"0 10px 25px -5px rgba(0,0,0,0.3)",backdropFilter:"blur(8px)"}}>
          <button onClick={onOpen} style={{background:isDark?"#6366f1":"#4f46e5",color:"white",border:"none",padding:"8px 20px",borderRadius:40,fontSize:13,fontWeight:600,cursor:"pointer",boxShadow:"0 4px 12px rgba(99,102,241,0.3)"}}>
            Compare ({count})
          </button>
          <button onClick={onClear} style={{background:"transparent",border:"none",color:T.textMuted,fontSize:18,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:4}} title="Clear comparison">
            &times;
          </button>
        </div>
      );
    }

    function ComparisonModal({confs, onClose, T, isDark, travelData}){
      const disc=isDark?D:D_LIGHT;
      const tiers=isDark?TIER:TIER_LIGHT;
      
      // Close on escape key
      useEffect(()=>{
        const h=e=>{if(e.key==="Escape")onClose();};
        window.addEventListener("keydown",h);
        return()=>window.removeEventListener("keydown",h);
      },[onClose]);

      const cellStyle={padding:"12px 16px",borderBottom:"1px solid "+T.divider,minWidth:200,verticalAlign:"top"};
      const labelStyle={position:"sticky",left:0,background:T.cardBg,zIndex:10,padding:"12px 16px",borderBottom:"1px solid "+T.divider,borderRight:"1px solid "+T.divider,fontWeight:600,color:T.textDim,fontSize:11,width:140,verticalAlign:"top"};

      return(
        <div style={{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:200,background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",padding:20}} onClick={onClose}>
          <div style={{background:T.bg,borderRadius:12,border:"1px solid "+T.cardBorder,width:"100%",maxWidth:1000,maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 20px 25px -5px rgba(0,0,0,0.3)",overflow:"hidden"}} onClick={e=>e.stopPropagation()}>
            <div style={{padding:"16px 20px",borderBottom:"1px solid "+T.divider,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
              <h2 style={{fontSize:18,fontWeight:700,color:T.textHeading,margin:0}}>Compare Conferences</h2>
              <button onClick={onClose} style={{background:"transparent",border:"none",color:T.textMuted,fontSize:24,cursor:"pointer",lineHeight:1}}>&times;</button>
            </div>
            <div style={{overflow:"auto",flex:1}}>
              <table style={{borderCollapse:"separate",borderSpacing:0,width:"100%"}}>
                <tbody>
                  <tr>
                    <td style={{...labelStyle,background:T.bg,borderTopLeftRadius:12}}>Name</td>
                    {confs.map(c=>(<td key={c.id} style={{...cellStyle,background:T.bg,fontWeight:600,color:T.textHeading,fontSize:14}}>{c.name}</td>))}
                  </tr>
                  <tr>
                    <td style={labelStyle}>Dates</td>
                    {confs.map(c=>(<td key={c.id} style={cellStyle}><span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:12}}>{c.dates}</span><div style={{fontSize:10,color:T.textDim,marginTop:4}}>{getDaysUntil(c.startDate)} days away</div></td>))}
                  </tr>
                  <tr>
                    <td style={labelStyle}>Location</td>
                    {confs.map(c=>(<td key={c.id} style={cellStyle}>{c.location}<div style={{color:T.textDim,fontSize:11,marginTop:2}}>{c.country}</div></td>))}
                  </tr>
                  <tr>
                    <td style={labelStyle}>Region</td>
                    {confs.map(c=>(<td key={c.id} style={cellStyle}>{getRegion(c.country)}</td>))}
                  </tr>
                  <tr>
                    <td style={labelStyle}>Deadline</td>
                    {confs.map(c=>{
                      const dl=getDeadlineStatus(c.deadline,isDark);
                      return(<td key={c.id} style={cellStyle}>
                        <div style={{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"}}>
                          <span style={{padding:"2px 6px",borderRadius:4,background:dl.bg,color:dl.color,fontSize:11,fontWeight:600,fontFamily:"'JetBrains Mono',monospace",border:dl.isTBD?"1px dashed rgba(107,114,128,0.35)":"none"}}>{dl.isTBD?"TBD":dl.label}</span>
                          {!dl.isTBD&&<span style={{color:T.textMuted,fontSize:11}}>{fmtDeadline(c.deadline)}</span>}
                        </div>
                      </td>);
                    })}
                  </tr>
                  <tr>
                    <td style={labelStyle}>Tier</td>
                    {confs.map(c=>{
                      const tier=c.tier?tiers[c.tier]:null;
                      return(<td key={c.id} style={cellStyle}>{tier?<span style={{padding:"2px 6px",borderRadius:4,background:tier.b,color:tier.c,fontSize:11,fontWeight:600}}>{tier.full}</span>:<span style={{color:T.textDim,fontSize:11}}>Unranked</span>}</td>);
                    })}
                  </tr>
                  <tr>
                    <td style={labelStyle}>Disciplines</td>
                    {confs.map(c=>(<td key={c.id} style={cellStyle}><div style={{display:"flex",gap:4,flexWrap:"wrap"}}>{c.disc.map(d=>{const dc=disc[d];return dc?<span key={d} style={{padding:"2px 6px",borderRadius:3,background:dc.b,color:dc.c,fontSize:10,fontWeight:600}}>{dc.l}</span>:null;})}</div></td>))}
                  </tr>
                  
                  {/* Travel Rows */}
                  <tr>
                    <td style={labelStyle}>Est. Daily Cost</td>
                    {confs.map(c=>{
                      const tr=getTravelInfo(c, travelData);
                      return(<td key={c.id} style={cellStyle}>
                        {tr && tr.hotel_max > 0 ? (
                          <div style={{fontFamily:"'JetBrains Mono',monospace",fontWeight:600,color:isDark?"#34d399":"#059669"}}>
                            ${tr.hotel_max + tr.meals}
                            <div style={{fontSize:10,color:T.textDim,fontWeight:400}}>max per diem</div>
                          </div>
                        ) : <span style={{color:T.textDim,fontSize:11}}>N/A</span>}
                      </td>);
                    })}
                  </tr>
                  <tr>
                    <td style={labelStyle}>Trip Cost (3d)</td>
                    {confs.map(c=>{
                      const tr=getTravelInfo(c, travelData);
                      return(<td key={c.id} style={cellStyle}>
                        {tr && tr.hotel_max > 0 ? (
                          <div style={{fontFamily:"'JetBrains Mono',monospace",fontWeight:700,color:isDark?"#34d399":"#059669"}}>
                            ${(tr.hotel_max + tr.meals) * 3}
                          </div>
                        ) : <span style={{color:T.textDim,fontSize:11}}>N/A</span>}
                      </td>);
                    })}
                  </tr>
                  <tr>
                    <td style={labelStyle}>Visa (US/CA)</td>
                    {confs.map(c=>{
                      const tr=getTravelInfo(c, travelData);
                      return(<td key={c.id} style={cellStyle}>
                        {tr ? (
                          <div style={{fontSize:11}}>
                            <div style={{marginBottom:2}}><span style={{color:T.textDim}}>US:</span> {tr.visa_us}</div>
                            <div><span style={{color:T.textDim}}>CA:</span> {tr.visa_ca}</div>
                          </div>
                        ) : <span style={{color:T.textDim,fontSize:11}}>N/A</span>}
                      </td>);
                    })}
                  </tr>

                  <tr>
                    <td style={{...labelStyle,borderBottom:"none"}}>Links</td>
                    {confs.map(c=>(
                      <td key={c.id} style={{...cellStyle,borderBottom:"none"}}>
                        <div style={{display:"flex",flexDirection:"column",gap:6,alignItems:"flex-start"}}>
                          <a href={c.url||c.ssrnLink} target="_blank" rel="noopener noreferrer" style={{color:isDark?"#818cf8":"#6366f1",fontSize:12,textDecoration:"none",fontWeight:500}}>
                            {c.url ? "Conference Page \u2192" : "SSRN Announcement \u2192"}
                          </a>
                          {c.url && c.ssrnLink && (
                             <a href={c.ssrnLink} target="_blank" rel="noopener noreferrer" style={{color:T.textDim,fontSize:11,textDecoration:"none"}}>
                               SSRN \u2192
                             </a>
                          )}
                        </div>
                      </td>
                    ))}
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      );
    }

    /* â”€â”€ Update Banner Component â”€â”€ */
    function UpdateBanner({ T, isDark }) {
      const BANNER_KEY = "conftracker-banner-v1";
      const [isVisible, setIsVisible] = useState(false);

      useEffect(() => {
        try {
          const dismissed = localStorage.getItem(BANNER_KEY);
          if (!dismissed) {
            setIsVisible(true);
          }
        } catch (e) {
          // localStorage can be disabled
          setIsVisible(true);
        }
      }, []);

      const handleDismiss = () => {
        try {
          localStorage.setItem(BANNER_KEY, "true");
        } catch (e) {}
        setIsVisible(false);
      };

      if (!isVisible) {
        return null;
      }

      return (
        <div className={`update-banner ${isDark ? 'dark' : 'light'}`}>
          <span>
            âœ¨ <strong>New:</strong> Travel cost estimates, calendar export (.ics), and conference comparison tool now available!
          </span>
          <button onClick={handleDismiss} className={`update-banner-dismiss ${isDark ? 'dark' : 'light'}`}>
            &times;
          </button>
        </div>
      );
    }

    /* â”€â”€ Card component â”€â”€ */
    function Card({conf,expanded,onToggle,sortBy,T,isDark,isSelected,onCompareToggle,travelData}){
      const disc=isDark?D:D_LIGHT;
      const regions=isDark?R:R_LIGHT;
      const tiers=isDark?TIER:TIER_LIGHT;
      const st=getTimeStatus(conf.startDate,isDark);const dl=getDeadlineStatus(conf.deadline,isDark);
      const region=getRegion(conf.country);const rStyle=regions[region]||regions.Other;
      const primaryBadge=sortBy==="deadline"?dl:st;
      const tier=conf.tier?tiers[conf.tier]:null;
      const linkUrl=conf.url||conf.ssrnLink;const linkLabel=conf.url?"Conference Page":"SSRN Announcement";
      
      const travel = useMemo(()=>getTravelInfo(conf, travelData), [conf, travelData]);
      const [tripDays, setTripDays] = useState(3);

      const handleCheckbox=(e)=>{
        e.stopPropagation();
        onCompareToggle(conf.id);
      };

      return(
        <div onClick={onToggle} style={{background:T.cardBg,border:"1px solid "+T.cardBorder,borderRadius:10,cursor:"pointer",transition:"all 0.15s"}}
          onMouseEnter={e=>{e.currentTarget.style.background=T.cardHover;e.currentTarget.style.borderColor=T.cardBorderHover;}}
          onMouseLeave={e=>{e.currentTarget.style.background=T.cardBg;e.currentTarget.style.borderColor=T.cardBorder;}}>
          <div style={{padding:"13px 16px",display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"}}>
            <div onClick={handleCheckbox} style={{display:"flex",alignItems:"center",justifyContent:"center",width:18,height:18,borderRadius:4,border:"1px solid "+(isSelected?isDark?"#6366f1":"#4f46e5":T.cardBorder),background:isSelected?(isDark?"#6366f1":"#4f46e5"):"transparent",cursor:"pointer",transition:"all 0.1s",marginRight:2}}>
              {isSelected&&<span style={{color:"white",fontSize:12,fontWeight:700,lineHeight:1}}>âœ“</span>}
            </div>
            <div style={{minWidth:62,padding:"3px 7px",borderRadius:5,background:primaryBadge.bg,color:primaryBadge.color,fontSize:10,fontWeight:700,letterSpacing:"0.04em",textAlign:"center",fontFamily:"'JetBrains Mono',monospace",border:primaryBadge.isTBD?"1px dashed rgba(107,114,128,0.4)":"1px solid transparent"}}>{primaryBadge.label}</div>
            <div style={{flex:1,minWidth:170}}>
              <div style={{display:"flex",alignItems:"center",gap:5,flexWrap:"wrap"}}>
                <span style={{fontWeight:600,color:T.textBright,fontSize:13,letterSpacing:"-0.01em"}}>{conf.name}</span>
                {tier&&<span style={{padding:"1px 5px",borderRadius:3,background:tier.b,color:tier.c,fontSize:7.5,fontWeight:700,letterSpacing:"0.06em",fontFamily:"'JetBrains Mono',monospace"}}>{tier.l}</span>}
                {conf.disc.map(d=>{const dc=disc[d];return dc?<span key={d} style={{padding:"1px 5px",borderRadius:3,background:dc.b,color:dc.c,fontSize:7.5,fontWeight:700,letterSpacing:"0.06em"}}>{dc.l}</span>:null;})}
              </div>
            </div>
            <div style={{minWidth:90,textAlign:"right"}}><div style={{color:T.textDim,fontSize:9,fontWeight:500}}>Date</div><div style={{color:T.text,fontSize:11,fontWeight:600,fontFamily:"'JetBrains Mono',monospace"}}>{conf.dates}</div></div>
            <div style={{minWidth:95,textAlign:"right"}}><span style={{color:T.textMuted,fontSize:10.5}}>{conf.location.length>22?conf.location.slice(0,20)+"...":conf.location}</span></div>
            <div style={{color:T.textDim,fontSize:13,transition:"transform 0.2s",transform:expanded?"rotate(180deg)":"none"}}>&#9662;</div>
          </div>
          {expanded&&(
            <div style={{padding:"0 16px 13px",borderTop:"1px solid "+T.divider,paddingTop:13}}>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:9,marginBottom:16}}>
                <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>LOCATION</div><div style={{color:T.text,fontSize:11.5}}>{conf.location}</div></div>
                <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>COUNTRY</div><div style={{color:T.text,fontSize:11.5}}>{conf.country}</div></div>
                <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>REGION</div><div style={{color:(regions[region]||regions.Other).c,fontSize:11.5}}>{region}</div></div>
                <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>DEADLINE</div>
                  <div style={{display:"flex",alignItems:"center",gap:5}}>
                    <span style={{padding:"2px 6px",borderRadius:4,background:dl.bg,color:dl.color,fontSize:10,fontWeight:600,fontFamily:"'JetBrains Mono',monospace",border:dl.isTBD?"1px dashed rgba(107,114,128,0.35)":"none"}}>{dl.isTBD?"TBD":dl.label}</span>
                    {!dl.isTBD&&<span style={{color:T.textMuted,fontSize:10}}>{fmtDeadline(conf.deadline)}</span>}
                  </div>
                </div>
                <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>CONFERENCE</div>
                  <div style={{display:"flex",alignItems:"center",gap:5}}>
                    <span style={{padding:"2px 6px",borderRadius:4,background:st.bg,color:st.color,fontSize:10,fontWeight:600,fontFamily:"'JetBrains Mono',monospace"}}>{st.label}</span>
                    <span style={{color:T.textMuted,fontSize:10}}>{conf.dates}</span>
                  </div>
                </div>
                <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>TIER</div>
                  <div>{tier?<span style={{padding:"2px 6px",borderRadius:4,background:tier.b,color:tier.c,fontSize:10,fontWeight:600}}>{tier.full}</span>:<span style={{color:T.textDim,fontSize:10}}>Unranked</span>}</div>
                </div>
                <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>DISCIPLINES</div>
                  <div style={{display:"flex",gap:3,flexWrap:"wrap"}}>
                    {conf.disc.map(d=>{const dc=disc[d];return dc?<span key={d} style={{padding:"2px 6px",borderRadius:3,background:dc.b,color:dc.c,fontSize:10}}>{dc.l==="ACCT"?"Accounting":dc.l==="FIN"?"Finance":"Economics"}</span>:null;})}
                  </div>
                </div>
              </div>

              {travel && travel.hotel_max > 0 && (
                <div style={{marginBottom:16,padding:"10px 12px",borderRadius:8,background:isDark?"rgba(16,185,129,0.06)":"rgba(16,185,129,0.04)",border:"1px solid "+(isDark?"rgba(16,185,129,0.15)":"rgba(16,185,129,0.1)")}}>
                  <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8}}>
                    <div style={{fontSize:11,fontWeight:700,color:isDark?"#34d399":"#059669",display:"flex",alignItems:"center",gap:6}}>
                      <span>ðŸ’° TRAVEL ESTIMATES</span>
                      <div className="tooltip-container">
                        <span className="tooltip-icon">i</span>
                        <div className="tooltip">
                          Per diem rates based on U.S. GSA rates (domestic) and State Department rates (international). Includes max lodging + meals & incidental expenses (M&IE) allowances. Actual costs may vary by season and availability.
                        </div>
                      </div>
                      <span style={{fontSize:9,fontWeight:400,color:T.textDimmer,background:T.bg,padding:"1px 4px",borderRadius:3,border:"1px solid "+T.cardBorder}}>Src: {travel.source}</span>
                    </div>
                    <div style={{fontSize:10,color:T.textDim,display:"flex",alignItems:"center",gap:4}}>
                      <label htmlFor={"days-"+conf.id}>Trip Days:</label>
                      <input id={"days-"+conf.id} type="number" min="1" max="14" value={tripDays} onChange={e=>setTripDays(Math.max(1,parseInt(e.target.value)||1))} onClick={e=>e.stopPropagation()}
                        style={{width:40,padding:"2px 4px",fontSize:10,borderRadius:4,border:"1px solid "+T.inputBorder,background:T.inputBg,color:T.text,fontFamily:"'JetBrains Mono',monospace"}} />
                    </div>
                  </div>
                  
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}>
                    <div>
                      <div style={{fontSize:10,color:T.textDim,marginBottom:2}}>PER DIEM (MAX)</div>
                      <div style={{fontSize:12,fontWeight:600,fontFamily:"'JetBrains Mono',monospace"}}>
                        <span style={{color:T.textBright}}>${travel.hotel_max + travel.meals}</span>
                        <span style={{fontSize:10,color:T.textMuted,fontWeight:400}}> /day</span>
                      </div>
                      <div style={{fontSize:9,color:T.textDim,marginTop:1}}>Hotel: ${travel.hotel_max} Â· Meals: ${travel.meals}</div>
                    </div>
                    
                    <div>
                      <div style={{fontSize:10,color:T.textDim,marginBottom:2}}>EST. TRIP TOTAL</div>
                      <div style={{fontSize:12,fontWeight:700,color:isDark?"#34d399":"#059669",fontFamily:"'JetBrains Mono',monospace"}}>
                        ${(travel.hotel_max + travel.meals) * tripDays}
                      </div>
                      <div style={{fontSize:9,color:T.textDim,marginTop:1}}>For {tripDays} days</div>
                    </div>
                    
                    <div style={{gridColumn:"1 / -1",borderTop:"1px solid "+(isDark?"rgba(16,185,129,0.1)":"rgba(16,185,129,0.08)"),paddingTop:8,display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                       <div>
                         <div style={{fontSize:9,fontWeight:600,color:T.textDim,marginBottom:1}}>VISA REQ (US/CA)</div>
                         <div style={{fontSize:10,color:T.text}}>{travel.visa_us} / {travel.visa_ca}</div>
                       </div>
                       <div>
                         <div style={{fontSize:9,fontWeight:600,color:T.textDim,marginBottom:1}}>TOURIST INFO</div>
                         <div style={{fontSize:10,color:T.text}}>{travel.tourist_highlights}</div>
                       </div>
                    </div>
                  </div>
                </div>
              )}

              <div style={{display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"}}>
                <a href={linkUrl} target="_blank" rel="noopener noreferrer" onClick={e=>e.stopPropagation()}
                  style={{display:"inline-flex",alignItems:"center",gap:5,padding:"5px 11px",borderRadius:5,background:conf.url?(isDark?"rgba(16,185,129,0.15)":"rgba(16,185,129,0.1)"):(isDark?"rgba(99,102,241,0.15)":"rgba(99,102,241,0.1)"),color:conf.url?(isDark?"#34d399":"#059669"):(isDark?"#818cf8":"#6366f1"),fontSize:11,fontWeight:600,textDecoration:"none"}}>
                  {linkLabel+" \u2192"}
                </a>
                {conf.url&&<a href={conf.ssrnLink} target="_blank" rel="noopener noreferrer" onClick={e=>e.stopPropagation()}
                  style={{display:"inline-flex",alignItems:"center",gap:5,padding:"5px 11px",borderRadius:5,background:isDark?"rgba(99,102,241,0.1)":"rgba(99,102,241,0.06)",color:isDark?"#818cf8":"#6366f1",fontSize:10,fontWeight:500,textDecoration:"none"}}>
                  {"SSRN \u2192"}
                </a>}
                <span style={{color:T.textDimmer,fontSize:9,fontFamily:"'JetBrains Mono',monospace"}}>{"SID: "+conf.sid}</span>
                <button onClick={(e)=>{e.stopPropagation();handleExportOne(conf);}} 
                  style={{marginLeft:"auto",display:"inline-flex",alignItems:"center",gap:5,padding:"5px 11px",borderRadius:5,background:isDark?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.04)",color:T.textMuted,fontSize:10,fontWeight:500,border:"1px solid "+T.btnBorder,cursor:"pointer",fontFamily:"'JetBrains Mono',monospace"}}>
                  ðŸ“… Add to Calendar
                </button>
              </div>
            </div>
          )}
        </div>
      );
    }


    /* â”€â”€ Main App â”€â”€ */
    function App(){
      const[themeMode,setThemeMode]=useState(getInitialTheme);
      const isDark=themeMode==="dark";
      const T=THEMES[themeMode];
      const disc=isDark?D:D_LIGHT;
      const regions=isDark?R:R_LIGHT;
      const tiers=isDark?TIER:TIER_LIGHT;

      const toggleTheme=useCallback(()=>{
        setThemeMode(prev=>{
          const next=prev==="dark"?"light":"dark";
          try{localStorage.setItem(THEME_KEY,next);}catch{}
          document.documentElement.className=next==="light"?"light":"";
          return next;
        });
      },[]);

      useEffect(()=>{
        document.documentElement.className=isDark?"":"light";
      },[isDark]);

      const[conferences,setConferences]=useState([]);
      const[travelData,setTravelData]=useState(null);
      const[loading,setLoading]=useState(true);
      const[error,setError]=useState(null);
      const[lastFetched,setLastFetched]=useState(null);
      const[discFilter,setDiscFilter]=useState("all");
      const[regionFilter,setRegionFilter]=useState("all");
      const[tierFilter,setTierFilter]=useState("all");
      const[sortBy,setSortBy]=useState("deadline");
      const[search,setSearch]=useState("");
      const[expandedId,setExpandedId]=useState(null);
      const[view,setView]=useState("list");
      const[showArchive,setShowArchive]=useState(false);
      const[comparisonList,setComparisonList]=useState([]);
      const[showComparisonModal,setShowComparisonModal]=useState(false);

      const handleCompareToggle=useCallback((id)=>{
        setComparisonList(prev=>{
          if(prev.includes(id))return prev.filter(cid=>cid!==id);
          if(prev.length>=5){alert("You can compare up to 5 conferences.");return prev;}
          return[...prev,id];
        });
      },[]);

      useEffect(()=>{
        Promise.all([
          fetch(JSON_URL+"?t="+Date.now()).then(r=>{if(!r.ok)throw new Error("HTTP "+r.status);return r.json();}),
          fetch(TRAVEL_JSON_URL+"?t="+Date.now()).then(r=>{if(r.ok)return r.json();return null;}).catch(()=>null)
        ])
          .then(([data, tData])=>{
            const expanded=data.map(expandRaw);
            const deduped=deduplicateBySid(expanded);
            setConferences(deduped);
            setTravelData(tData);
            setLastFetched(new Date().toLocaleTimeString());
            setLoading(false);
          })
          .catch(err=>{setError(err.message);setLoading(false);});
      },[]);

      const upcoming=useMemo(()=>conferences.filter(c=>getDaysUntil(c.startDate)>=0),[conferences]);
      const pastConfs=useMemo(()=>conferences.filter(c=>getDaysUntil(c.startDate)<0).sort((a,b)=>new Date(b.startDate)-new Date(a.startDate)),[conferences]);

      const filtered=useMemo(()=>{
        let r=upcoming;
        if(discFilter!=="all")r=r.filter(c=>c.disc.includes(discFilter));
        if(regionFilter!=="all")r=r.filter(c=>getRegion(c.country)===regionFilter);
        if(tierFilter!=="all")r=r.filter(c=>tierFilter==="unranked"?!c.tier:c.tier===tierFilter);
        if(search){const s=search.toLowerCase();r=r.filter(c=>c.name.toLowerCase().includes(s)||c.location.toLowerCase().includes(s)||c.country.toLowerCase().includes(s));}
        if(sortBy==="deadline")r=[...r].sort((a,b)=>{const ak=getDeadlineSortKey(a),bk=getDeadlineSortKey(b);if(ak===bk)return new Date(a.startDate)-new Date(b.startDate);return new Date(ak)-new Date(bk);});
        else r=[...r].sort((a,b)=>new Date(a.startDate)-new Date(b.startDate));
        return r;
      },[upcoming,discFilter,regionFilter,tierFilter,search,sortBy]);

      const filteredPast=useMemo(()=>{
        let r=pastConfs;
        if(discFilter!=="all")r=r.filter(c=>c.disc.includes(discFilter));
        if(search){const s=search.toLowerCase();r=r.filter(c=>c.name.toLowerCase().includes(s)||c.location.toLowerCase().includes(s)||c.country.toLowerCase().includes(s));}
        return r;
      },[pastConfs,discFilter,search]);

      const counts=useMemo(()=>{
        const tbdCount=upcoming.filter(c=>isTBD(c.deadline)).length;
        return{total:conferences.length,upcoming:upcoming.length,past:pastConfs.length,
          acct:conferences.filter(c=>c.disc.includes("acct")).length,
          fin:conferences.filter(c=>c.disc.includes("fin")).length,
          econ:conferences.filter(c=>c.disc.includes("econ")).length,
          countries:new Set(conferences.map(c=>c.country)).size,
          soon:upcoming.filter(c=>getDaysUntil(c.startDate)<=60).length,
          tbd:tbdCount,confirmed:upcoming.length-tbdCount,
        };
      },[conferences,upcoming,pastConfs]);

      const timelineMonths=[];
      for(let i=0;i<14;i++){const d=new Date(TODAY);d.setMonth(d.getMonth()+i);timelineMonths.push({year:d.getFullYear(),month:d.getMonth()});}

      const btn=(active)=>({padding:"5px 11px",borderRadius:5,border:"1px solid "+(active?T.btnActiveBorder:T.btnBorder),background:active?T.btnActiveBg:T.btnBg,color:active?T.btnActiveColor:T.btnColor,fontSize:11,fontWeight:500,cursor:"pointer",transition:"all 0.15s"});

      if(loading)return(<div style={{minHeight:"100vh",background:T.bg,display:"flex",alignItems:"center",justifyContent:"center"}}><div style={{color:"#818cf8",fontSize:14,fontFamily:"'JetBrains Mono',monospace"}}>Loading conferences...</div></div>);
      if(error)return(<div style={{minHeight:"100vh",background:T.bg,display:"flex",alignItems:"center",justifyContent:"center"}}><div style={{textAlign:"center"}}><div style={{color:"#f87171",fontSize:14,fontFamily:"'JetBrains Mono',monospace",marginBottom:8}}>Failed to load data</div><div style={{color:T.textDim,fontSize:11}}>{error}</div><div style={{color:T.textDim,fontSize:10,marginTop:12}}>Make sure conferences.json is in the same folder as this page.</div></div></div>);

      return(
        <div style={{minHeight:"100vh",background:T.bg,color:T.text,fontFamily:"'Newsreader','Georgia','Times New Roman',serif",transition:"background 0.3s ease, color 0.3s ease"}}>
          {/* HEADER */}
          <div style={{padding:"30px 20px 22px",background:T.headerGrad,borderBottom:"1px solid "+T.headerBorder}}>
            <div style={{maxWidth:980,margin:"0 auto"}}>
              <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:2}}>
                <h1 style={{fontSize:24,fontWeight:700,letterSpacing:"-0.03em",color:T.textHeading,margin:0,flex:1}}>Academic Conference Tracker</h1>
                <ThemeToggle isDark={isDark} onToggle={toggleTheme} T={T} />
              </div>
              <div style={{display:"flex",alignItems:"baseline",gap:10}}>
                <span style={{fontSize:10,color:T.textDim,fontFamily:"'JetBrains Mono',monospace"}}>2025-onwards</span>
              </div>
              <p style={{color:T.textDim,fontSize:11.5,margin:"2px 0 0",fontFamily:"'JetBrains Mono','SF Mono',monospace"}}>
                {"Finance \u00b7 Accounting \u00b7 Economics \u2014 SSRN Networks FEN/ARN/ERN \u00b7 "+TODAY_STR}
              </p>
              <div style={{display:"flex",gap:22,marginTop:18,flexWrap:"wrap"}}>
                {[{n:counts.total,l:"TOTAL",c:isDark?"#818cf8":"#6366f1"},{n:counts.upcoming,l:"UPCOMING",c:isDark?"#10b981":"#059669"},{n:counts.past,l:"PAST",c:"#6b7280"},{n:counts.soon,l:"\u226460 DAYS",c:counts.soon>0?(isDark?"#f59e0b":"#d97706"):T.textDim},{n:counts.confirmed,l:"DL SET",c:counts.confirmed>0?(isDark?"#34d399":"#059669"):T.textDim},{n:counts.tbd,l:"TBD",c:"#6b7280"},{n:counts.countries,l:"COUNTRIES",c:isDark?"#a78bfa":"#7c3aed"}].map(s=>(
                  <div key={s.l}><div style={{fontSize:26,fontWeight:700,color:s.c,fontFamily:"'JetBrains Mono',monospace",lineHeight:1}}>{s.n}</div>
                  <div style={{fontSize:8.5,color:T.textDim,fontWeight:600,letterSpacing:"0.1em",marginTop:2,fontFamily:"'JetBrains Mono',monospace"}}>{s.l}</div></div>
                ))}
              </div>
            </div>
          </div>

          {/* CONTROLS */}
          <div style={{maxWidth:980,margin:"0 auto",padding:"14px 20px"}}>
            <div style={{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap",marginBottom:10}}>
              <input type="text" placeholder="Search name, location, country..." value={search} onChange={e=>setSearch(e.target.value)}
                style={{flex:1,minWidth:170,padding:"7px 11px",borderRadius:6,border:"1px solid "+T.inputBorder,background:T.inputBg,color:T.text,fontSize:12,outline:"none",fontFamily:"'JetBrains Mono',monospace"}} />
              <div style={{display:"flex",gap:2,background:T.switchBg,borderRadius:5,padding:2}}>
                {["list","timeline"].map(v=><button key={v} onClick={()=>setView(v)} style={{padding:"5px 10px",borderRadius:4,border:"none",background:view===v?T.viewBtnBg:T.viewBtnOffBg,color:view===v?T.viewBtnColor:T.viewBtnOffColor,fontSize:10.5,cursor:"pointer",textTransform:"capitalize",fontFamily:"'JetBrains Mono',monospace"}}>{v}</button>)}
              </div>

            </div>

            <div style={{display:"flex",gap:4,flexWrap:"wrap",alignItems:"center",marginBottom:6}}>
              {[["all","All"],["acct","Accounting ("+counts.acct+")"],["fin","Finance ("+counts.fin+")"],["econ","Economics ("+counts.econ+")"]].map(([v,l])=><button key={v} style={btn(discFilter===v)} onClick={()=>setDiscFilter(v)}>{l}</button>)}
              <span style={{width:1,height:16,background:T.dividerSubtle,margin:"0 2px"}} />
              {[["all","All Regions"],["N. America","N. America"],["Europe","Europe"],["Asia-Pacific","Asia-Pac"],["Virtual","Virtual"]].map(([v,l])=><button key={v} style={btn(regionFilter===v)} onClick={()=>setRegionFilter(v)}>{l}</button>)}
            </div>

            <div style={{display:"flex",gap:4,flexWrap:"wrap",alignItems:"center",marginBottom:6}}>
              <span style={{fontSize:10,color:T.textDim,fontFamily:"'JetBrains Mono',monospace",fontWeight:600,letterSpacing:"0.06em",marginRight:2}}>SORT</span>
              {[["deadline","By Deadline"],["confdate","By Conference Date"]].map(([v,l])=><button key={v} style={btn(sortBy===v)} onClick={()=>setSortBy(v)}>{l}</button>)}
              <span style={{width:1,height:16,background:T.dividerSubtle,margin:"0 4px"}} />
              <span style={{fontSize:10,color:T.textDim,fontFamily:"'JetBrains Mono',monospace",fontWeight:600,letterSpacing:"0.06em",marginRight:2}}>TIER</span>
              {[["all","All"],["1","T1"],["2","T2"],["3","T3"],["unranked","Unranked"]].map(([v,l])=><button key={v} style={btn(tierFilter===v)} onClick={()=>setTierFilter(v)}>{l}</button>)}
              <span style={{width:1,height:16,background:T.dividerSubtle,margin:"0 4px"}} />
              <button onClick={()=>handleExportAll(filtered)} style={{...btn(false),display:"flex",alignItems:"center",gap:4}}>
                <span>ðŸ“…</span><span>Export All</span>
              </button>
            </div>


          </div>

          {/* MAIN LIST */}
          <div style={{maxWidth:980,margin:"0 auto",padding:"0 20px 36px"}}>
            <UpdateBanner T={T} isDark={isDark} />
            <div style={{fontSize:10,color:T.textDim,marginBottom:8,fontFamily:"'JetBrains Mono',monospace"}}>
              {"Showing "+filtered.length+" upcoming"+(sortBy==="deadline"?" \u00b7 sorted by deadline":" \u00b7 sorted by conference date")}
            </div>

            {view==="list"?(
              <div style={{display:"flex",flexDirection:"column",gap:4,marginTop:4}}>
                {filtered.length===0?<div style={{textAlign:"center",padding:36,color:T.textDim,fontSize:13}}>No upcoming conferences match your filters.</div>
                :filtered.map(c=><Card key={c.id} conf={c} expanded={expandedId===c.id} onToggle={()=>setExpandedId(expandedId===c.id?null:c.id)} sortBy={sortBy} T={T} isDark={isDark} isSelected={comparisonList.includes(c.id)} onCompareToggle={handleCompareToggle} travelData={travelData} />)}
              </div>
            ):(
              <div style={{marginTop:10}}>
                {timelineMonths.map(({year,month})=>{
                  const evs=filtered.filter(c=>{const d=new Date(c.startDate+"T12:00:00");return d.getFullYear()===year&&d.getMonth()===month;});
                  if(!evs.length)return null;
                  const ml=new Date(year,month).toLocaleDateString("en-US",{month:"long",year:"numeric"});
                  const isCur=TODAY.getFullYear()===year&&TODAY.getMonth()===month;
                  return(
                    <div key={year+"-"+month} style={{marginBottom:18}}>
                      <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:7}}>
                        <div style={{fontSize:14,fontWeight:700,color:isCur?(isDark?"#818cf8":"#6366f1"):T.textMuted}}>{ml}</div>
                        {isCur&&<span style={{fontSize:8,fontWeight:700,letterSpacing:"0.1em",color:isDark?"#818cf8":"#6366f1",background:isDark?"rgba(129,140,248,0.12)":"rgba(99,102,241,0.1)",padding:"2px 5px",borderRadius:3,fontFamily:"'JetBrains Mono',monospace"}}>NOW</span>}
                        <span style={{fontSize:9,color:T.textDim,fontFamily:"'JetBrains Mono',monospace"}}>{evs.length+" event"+(evs.length!==1?"s":"")}</span>
                        <div style={{flex:1,height:1,background:T.divider}} />
                      </div>
                      {evs.map(c=>{
                        const dc=c.disc[0]?disc[c.disc[0]]:disc.fin;const dl=getDeadlineStatus(c.deadline,isDark);const tier=c.tier?tiers[c.tier]:null;
                        return(
                          <div key={"ev-"+c.id} onClick={()=>setExpandedId(expandedId===c.id?null:c.id)}
                            style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",marginBottom:3,borderRadius:6,background:isDark?dc.b.replace("0.12","0.04"):dc.b.replace("0.08","0.03"),borderLeft:"3px solid "+dc.c,cursor:"pointer",transition:"background 0.1s"}}
                            onMouseEnter={e=>{e.currentTarget.style.background=isDark?dc.b.replace("0.12","0.08"):dc.b.replace("0.08","0.06");}}
                            onMouseLeave={e=>{e.currentTarget.style.background=isDark?dc.b.replace("0.12","0.04"):dc.b.replace("0.08","0.03");}}>
                            <span style={{fontSize:10,fontWeight:600,color:dc.c,minWidth:52,fontFamily:"'JetBrains Mono',monospace"}}>{fmtShort(c.startDate)}</span>
                            <div style={{display:"flex",gap:3}}>
                              {c.disc.map(d=>{const dd=disc[d];return dd?<span key={d} style={{fontSize:7,color:dd.c,fontWeight:700,letterSpacing:"0.06em",fontFamily:"'JetBrains Mono',monospace"}}>{dd.l}</span>:null;})}
                            </div>
                            {tier&&<span style={{fontSize:7,fontWeight:700,color:tier.c,fontFamily:"'JetBrains Mono',monospace"}}>{tier.l}</span>}
                            <span style={{fontSize:12,color:T.textBright,fontWeight:500,flex:1}}>{c.name}</span>
                            <span style={{padding:"1px 5px",borderRadius:3,fontSize:8,fontWeight:600,fontFamily:"'JetBrains Mono',monospace",background:dl.bg,color:dl.color,border:dl.isTBD?"1px dashed rgba(107,114,128,0.35)":"none"}}>{dl.isTBD?"TBD":"DL: "+dl.label}</span>
                            <span style={{fontSize:10,color:T.textDim}}>{c.location.length>25?c.location.slice(0,23)+"...":c.location}</span>
                          </div>
                        );
                      })}
                      {evs.filter(c=>expandedId===c.id).map(c=>{
                        const region=getRegion(c.country);const dl=getDeadlineStatus(c.deadline,isDark);const st=getTimeStatus(c.startDate,isDark);const tier=c.tier?tiers[c.tier]:null;const linkUrl=c.url||c.ssrnLink;
                        return(
                          <div key={"detail-"+c.id} style={{margin:"4px 0 8px 14px",padding:12,borderRadius:8,background:isDark?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.02)",border:"1px solid "+T.cardBorder}}>
                            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8}}>
                              <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>LOCATION</div><div style={{color:T.text,fontSize:11}}>{c.location}</div></div>
                              <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>COUNTRY</div><div style={{color:T.text,fontSize:11}}>{c.country}</div></div>
                              <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>REGION</div><div style={{color:(regions[region]||regions.Other).c,fontSize:11}}>{region}</div></div>
                              <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>DEADLINE</div>
                                <div style={{display:"flex",alignItems:"center",gap:4}}>
                                  <span style={{padding:"2px 5px",borderRadius:3,fontSize:9,fontWeight:600,fontFamily:"'JetBrains Mono',monospace",background:dl.bg,color:dl.color,border:dl.isTBD?"1px dashed rgba(107,114,128,0.35)":"none"}}>{dl.isTBD?"TBD":dl.label}</span>
                                  {!dl.isTBD&&<span style={{color:T.textMuted,fontSize:9}}>{fmtDeadline(c.deadline)}</span>}
                                </div>
                              </div>
                              <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>CONFERENCE</div>
                                <span style={{padding:"2px 5px",borderRadius:3,fontSize:9,fontWeight:600,fontFamily:"'JetBrains Mono',monospace",background:st.bg,color:st.color}}>{st.label}</span>
                              </div>
                              <div><div style={{color:T.textDim,fontSize:8.5,fontWeight:600,letterSpacing:"0.1em",marginBottom:2}}>TIER</div>
                                {tier?<span style={{padding:"2px 5px",borderRadius:3,fontSize:9,fontWeight:600,background:tier.b,color:tier.c}}>{tier.full}</span>:<span style={{color:T.textDim,fontSize:10}}>Unranked</span>}
                              </div>
                            </div>
                            <a href={linkUrl} target="_blank" rel="noopener noreferrer"
                              style={{display:"inline-flex",alignItems:"center",gap:5,padding:"4px 10px",borderRadius:5,background:c.url?(isDark?"rgba(16,185,129,0.15)":"rgba(16,185,129,0.1)"):(isDark?"rgba(99,102,241,0.15)":"rgba(99,102,241,0.1)"),color:c.url?(isDark?"#34d399":"#059669"):(isDark?"#818cf8":"#6366f1"),fontSize:10,fontWeight:600,textDecoration:"none",marginTop:8}}>
                              {(c.url?"Conference Page":"SSRN Announcement")+" \u2192"}
                            </a>
                          </div>
                        );
                      })}
                    </div>
                  );
                })}
              </div>
            )}

            {/* PAST CONFERENCES */}
            {filteredPast.length>0&&(
              <div style={{marginTop:26}}>
                <div onClick={()=>setShowArchive(!showArchive)} style={{display:"flex",alignItems:"center",gap:8,cursor:"pointer",padding:"10px 14px",borderRadius:8,background:T.archiveBg,border:"1px solid "+T.archiveBorder}}>
                  <span style={{color:T.textDim,fontSize:13,transition:"transform 0.2s",transform:showArchive?"rotate(180deg)":"none"}}>&#9662;</span>
                  <span style={{fontSize:13,fontWeight:600,color:"#6b7280"}}>Past Conferences</span>
                  <span style={{fontSize:10,color:T.textDim,fontFamily:"'JetBrains Mono',monospace"}}>{filteredPast.length} conferences</span>
                  <div style={{flex:1,height:1,background:T.dividerLight}} />
                </div>
                {showArchive&&(
                  <div style={{marginTop:6,display:"flex",flexDirection:"column",gap:3,opacity:0.7}}>
                    {filteredPast.map(c=>{
                      const dc=c.disc[0]?disc[c.disc[0]]:disc.fin;const tier=c.tier?tiers[c.tier]:null;
                      return(
                        <div key={"past-"+c.id} style={{display:"flex",alignItems:"center",gap:8,padding:"5px 10px",borderRadius:5,background:T.pastBg,borderLeft:"2px solid "+T.pastBorder}}>
                          <span style={{fontSize:9,color:T.textDim,minWidth:52,fontFamily:"'JetBrains Mono',monospace"}}>{fmtShort(c.startDate)}</span>
                          {c.disc.map(d=>{const dd=disc[d];return dd?<span key={d} style={{fontSize:7,color:dd.c,opacity:0.6,fontWeight:700,fontFamily:"'JetBrains Mono',monospace"}}>{dd.l}</span>:null;})}
                          {tier&&<span style={{fontSize:7,color:tier.c,opacity:0.6,fontWeight:700,fontFamily:"'JetBrains Mono',monospace"}}>{tier.l}</span>}
                          <span style={{fontSize:11.5,color:T.textMuted,flex:1}}>{c.name}</span>
                          <span style={{fontSize:9,color:T.textDimmer}}>{c.location.length>25?c.location.slice(0,23)+"...":c.location}</span>
                          <span style={{padding:"1px 4px",borderRadius:3,fontSize:8,color:"#6b7280",background:isDark?"rgba(107,114,128,0.08)":"rgba(107,114,128,0.1)",fontFamily:"'JetBrains Mono',monospace"}}>PAST</span>
                        </div>
                      );
                    })}
                  </div>
                )}
              </div>
            )}

            {/* FOOTER */}
            <div style={{marginTop:26,padding:14,borderRadius:8,background:T.footerBg,border:"1px solid "+T.footerBorder}}>
              <div style={{fontSize:10,color:T.textDim,lineHeight:1.6}}>
                <strong style={{color:T.textMuted}}>Disclaimer:</strong> Conference dates sourced from SSRN professional announcement networks (FEN, ARN, ERN). Deadlines marked TBD until confirmed. Tiers assigned via web research. Always verify on the official conference website.
              </div>
              <div style={{fontSize:9.5,color:T.textDimmer,marginTop:5}}>
                {"Sources: SSRN FEN, ARN & ERN \u00b7 "+counts.total+" conferences ("+counts.upcoming+" upcoming, "+counts.past+" past) \u00b7 "+counts.countries+" countries"}
              </div>
            </div>
          </div>
          <ComparisonFloater count={comparisonList.length} onOpen={()=>setShowComparisonModal(true)} onClear={()=>setComparisonList([])} T={T} isDark={isDark} />
          {showComparisonModal && <ComparisonModal confs={conferences.filter(c=>comparisonList.includes(c.id))} onClose={()=>setShowComparisonModal(false)} T={T} isDark={isDark} travelData={travelData} />}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>

  <!-- Vercel Speed Insights -->
  <script>
    window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/speed-insights/script.js"></script>
</body>
</html>
